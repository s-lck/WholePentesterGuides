# \[Redirector] Apache

## Pratique

### Installation

* Debian or Ubuntu

```
sudo apt install apache2
sudo a2enmod rewrite proxy proxy_http proxy_connect
a2ensite 000-default.conf
sudo service apache2 restart
```

* For **HTTPS **redirector

```
sudo a2enmod ssl
a2ensite default-ssl.conf
sudo service apache2 restart
```

* `<ip>:80` should display the default Apache page
  * _Set a real web site to make it more real_

### Redirection

* `vim /etc/apache2/sites-enabled/000-default.conf`

```
ProxyRequests Off
ProxyPass </url1/page1.html> <http://<ip_c2/url1/page1.html>
ProxyPassReverse </url1/page1.html> <http://<ip_c2/url1/page1.html>
ProxyPass </url2/page2.html> <http://<ip_c2/url2/page2.html>
ProxyPassReverse </url2/page2.html> <http://<ip_c2/url2/page2.html>
```

* `sudo service apache2 restart`

### Certificat SSL

* Generate Let's Encrypt certificat
  * `-d`: allow you to add multiple sub-domains (www, app ...)&#x20;

```
sudo service apache2 stop
sudo apt-get install certbot
sudo certbot certonly --standalone -d <dom> -d <subdom>.<dom>
```

* Cert files will be in `/etc/letsencrypt/live/spoofdomain.com`
* Edit /etc/apache2/sites-enabled/default-ssl.conf

```
SSLCertificateFile      /etc/letsencrypt/live/<dom>/cert.pem
SSLCertificateKeyFile   /etc/letsencrypt/live/<dom>/privkey.pem
SSLEngine On
SSLProxyEngine On
```

## Ressources

* [https://fatrodzianko.com/2019/08/16/covenant-c2-infrastructure-with-redirectors/](https://fatrodzianko.com/2019/08/16/covenant-c2-infrastructure-with-redirectors/)
* [https://www.youtube.com/watch?v=1uh5-OzBEqM\&ab\_channel=Conda](https://www.youtube.com/watch?v=1uh5-OzBEqM\&ab\_channel=Conda)
