# 139/445 - SMB

* Could be anonymously accessible
  * `smbclient -L \\<IP> -N`
    * `smbclient \\\\<IP>\\<FOLDER> -N`
    * `smbclient -U <USERNAME> \\\\<IP>\\<FOLDER>`
  * `smbmap -H <IP>`
  * `smbmap -H <IP> -R --depth 5`
    * `smbmap -H <IP> -d <DOMAIN> -u <USERNAME> -p <PASSWORD>` if you have credentials
  * `smb:\\<IP>` through the browser
  * `sudo crackmapexec smb <IP> -u '<USERNAME>' -p '<PASSWORD>' -d <DOMAIN> --shares`
    * `<USERNAME>` and `<PASSWORD>` can be null if you have no credentials
    * can also user `--users` ; `--rid-brute` ; `--pass-pol`
  * `smbget`
* Gather information
  * `enum4linux -a <IP>`
  * `smbver.sh` : To get the version of **Samba** using tcpdump and smbclient (launch it with root rights)
    * [https://github.com/rewardone/OSCPRepo/blob/master/scripts/recon\\\_enum/smbver.sh](https://github.com/rewardone/OSCPRepo/blob/master/scripts/recon/\_enum/smbver.sh)
      * `sudo tcpdump -s0 -n -i tap0 src <RHOST> and port <RPORT> -A -c 10 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]'`
      * `smbclient -L <RHOST>`
* Nmap NSE for SMB vulnerabilities `sudo nmap -p139,445 -vvv --script "smb-vuln*"`
* Nmap NSE for SMB anonymous access `sudo nmap -p139,445 -vvv --script "smb-enum*"`
* Nmap NSE for MS17-10 : `sudo nmap -p445 -vvv --script "*ms17-010*" <IP>`
* Symlink attack&#x20;

``

* `rpcclient -U "" <IP>` to login using null session
  * Command : `srvinfo` - `getdompwinfo` - `enumdomusers` - `enumdomgroups` - `queryuser <USERNAME>`
