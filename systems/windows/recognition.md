# Recognition



**Windows manually**

* Operating system full version and basic information : `systeminfo`
  * Check `C:\Windows\SoftwareDistribution\Download` for downloaded updates
  * Check `C:\Windows\WindowsUpdate.log` for installed upadtes
* Current user: `whoami /all`
* Logged users: `qwinsta`
* Local users: `net user`
* Local groups: `net localgroup`
* Is the device belong to a domain: `echo %userdomain%`
* WMIC access policy: `wmic`
* Some WMIC command:
  * Display KB: `wmic qfe`
  * Display startup program: `wmic startup get caption,command`
  * Display shares: `wmic share list`
  * Processes in execution: `wmic process list brief`
* Powershell policy (execution & contenus des scripts): WiP
* Environment variables: `set`
  * `LOGONSERVER`: Domain Controller name
* Windows Subsystem for Linux (WSL): WiP
* Runas policy : `cmdkey /list` will display the stored usernames and credentials
  * `dir /a C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Credentials\`
* Services missconfiguration:
  * `accesschk.exe -uwcqv "Authenticated Users" * /accepteula`
  * `accesschk.exe -ucqv <SERVICE_NAME> /accepteula`
  * `sc qc <SERVICE_NAME>`\
    \\
* IP and interfaces configuration: `ipconfig /all`
* Route configuration: `route PRINT -4`
* ARP table: `arp -A`
* Shares: `net share`
* Network connections: `netstat -ano`
* Local firewall state `netsh advfirewall show allprofiles state`\
  \\
* Files and directories enumeration: `accesschk.exe -r -s <USERNAME> <PATH>`
* Windows register
  * AlwaysInstallElevated:
    * `reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\`
    * `reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\`
    * Use the `metasploit` module `exploit/windows/local/always_install_elevated`
    * Use the `PowerSploit` module `Get-RegistryAlwaysInstallElevated`
* Bypass execution policy
  * Try to execute following extensions : `exe`, `bat`, `cmd`, `msi`, `dll`, `ps1`, `vbs`, `vbe`, `hta`, `js`, `cpl`, `scr`, `pif`
  * Signed files (csc.exe to sign a .DLL with a payload inside : regsvcs.dll)
* Unquoted service path: WiP
* Service BinPath : WiP
* Missing Autoruns: `autorunsc.exe -a | findstr /n /R "File not found"`
* DLL Hijacking: WiP\
  \\
* Running processes and services: `tasklist /V`
* Running Windows services : `net start` ; `sc query`
* Schduled task: `schtasks /query /fo LIST /v`
* Installed programs (check the version)
  * Antivirus tool
  * Web server
  * Databases\
    \\
* Password policy : `net accounts`
* Looking for password
  * Unattend files:
    * `C:\Windows\Panther\Unattend.xml`
    * `C:\Windows\Panther\Unattend\Unattend.xml`
    * Use the `PowerSploit` module `Get-UnattendedInstallFile`
  * In configuration files:
    * UltraVNC: You can find a password in the file `C:\Program Files\UltraVNC\ultravnc.ini` and break it with [vncpwd](https://github.com/jeroennijhof/vncpwd)
    * RealVNC: You can find a password in the registry key `HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\vncserver` and break it with [vncpwd](https://github.com/jeroennijhof/vncpwd)
    * TightVNC You can find a password in the registry key `HKEY_CURRENT_USER\Software\TightVNC\Server` and break it with [vncpwd](https://github.com/jeroennijhof/vncpwd)
    * TigerVNC You can find a password in the registry key `HKEY_LOCAL_USER\Software\TigerVNC\WinVNC4` and break it with [vncpwd](https://github.com/jeroennijhof/vncpwd)
    * WiP (other software)
  * Recursivly in the system: `findstr /SPIN "<PATTERN>" *.txt *.ini *.xml`
  * Through a metasploit session: `use post/windows/gather/credentials/*`
* Binaiaries : [https://lolbas-project.github.io/#](https://lolbas-project.github.io/#)

**Windows automatically**

* Sherlock: On the target machine `Import-Module Sherlock.ps1` then `Invoke-<FUNCTION> from Sherlock`
* Use the compiled version of [BeRoot](https://github.com/AlessandroZ/BeRoot/releases) for Windows\
  \\
* Find exploits available on the OS:
  * Windows Exploit Suggester: `./windows-exploit-suggester.py --update` then `./windows-exploit-suggester.py --database YYYY-MM-DD-mssb.xlsx --systeminfo systeminfo.txt`.
  * Windows Exploit Suggester Next Generation : [https://github.com/bitsadmin/wesng](https://github.com/bitsadmin/wesng)
  * On the target machine `windows-privesc-check2.exe --audit -a -o <REPORT_FILE>`
  * Exploits list: [windows-kernel-exploits](https://github.com/SecWiki/windows-kernel-exploits)
  * Metasploit : `local_exploit_suggester`
