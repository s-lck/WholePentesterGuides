# Web servers

### Apache

#### CGI

* mod\_cgi : handles all the CGI requests
  * La présence /cgi-bin/<> permet de savoir que Apache's mod\_cgi is enabled
* CGI-based web server : When a web server uses the Common Gateway Interface (CGI) to handle a document request, it copies certain information from the request into the environment variable list and then delegates the request to a handler program. If the handler is a Bash script, or if it executes one for example using the system(3) call, Bash will receive the environment variables passed by the server and will process them as described above. This provides a means for an attacker to trigger the Shellshock vulnerability with a specially crafted document request. OpenSSH server ; DHCP clients ; Qmail clients ; IBM HMC restricted shell

Web CGI programs can be written in any language which can process standard input (stdin), environment variables and write to standard output (stdout) Ex : [http://www.yolinux.com/TUTORIALS/BashShellCgi.html](http://www.yolinux.com/TUTORIALS/BashShellCgi.html)

On peut déposer un script shell/php/perl/python/... dans CGI bin pour le faire exécuter par l'application web. Si l'app web tourne en root le script sera lancé dans un context root (lancer un shell, créer un utilisateur ...) Doit commencer par echo/print/... "Content-type: text/html"

Code :

```
#!/bin/bash
echo "Content-type: text/html"		# Mandatory
echo ""								# Mandatory
echo "<html><head><title>Bash as CGI"
echo "</title></head><body>"

echo "<h1>Hello world</h1>"
echo "Today is $(<COMMAND>)"

echo "</body></html>"
```

Ajouter droits d'exécution : chmod +x first.cgi

* Red Hat Enterprise, 7.x-9, Fedora core, CentOS `/var/www/cgi-bin/`
* Red Hat 6.x and older `/home/httpd/cgi-bin/`
* SuSe `/srv/www/cgi-bin/`
* Ubuntu/Debian `/usr/lib/cgi-bin/`

### IIS

* [https://poc-server.com/blog/2018/05/22/rce-by-uploading-a-web-config/](https://poc-server.com/blog/2018/05/22/rce-by-uploading-a-web-config/)
* [https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)
* [https://soroush.secproject.com/blog/2014/07/file-upload-and-php-on-iis-wildcards/](https://soroush.secproject.com/blog/2014/07/file-upload-and-php-on-iis-wildcards/)

ASP, ASPX, ASP-EXE

#### IIS shortname vulnerability

* [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)
* [https://github.com/lijiejie/IIS\_shortname\_Scanner](https://github.com/lijiejie/IIS\_shortname\_Scanner)
* [https://en.wikipedia.org/wiki/8.3\_filename](https://en.wikipedia.org/wiki/8.3\_filename)
* [https://0xdf.gitlab.io/2020/06/08/endgame-poo.html#recon](https://0xdf.gitlab.io/2020/06/08/endgame-poo.html#recon)
