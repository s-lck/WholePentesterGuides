# Recognition

## Footprint

* Look for the web application name (footer, social network linked ...)
  * If OpenSource -> Search for the sources (GitHub repo ...)
    * Check the Changelog on the README.MD
    * Look for adminitrative panel
    * Look for vulnerabilities in the Issues of the Github
* Read the source code HTML/JS
  * Look for the used technoly
    * Ex: `CMS Made Simple`
  * Look for URL/URI
* Look for network connection make by the application
* Look for web pages extensions (php, html, asp(x))
  * If something is changing, it is dynamic

### subdomain

* `wfuzz -c -w /mnt/hgfs/PARTAGE-VM/SHARED/TOOLS/seclists/Discovery/DNS/subdomains-top1mil-5000.txt -H "HOST:FUZZ.<domaine>.<tld>" http://<domaine>.<tld>`
  * `--hl <NUMBER_OF_LINE_WHEN_400>`
  * `–ss and –hs allow to filter the responses using a regular expression against the returned content`
* Add `<DOMAIN>` in `/etc/hosts`
* Use cewl to find key word and make a specific wordlist

### Manual connection

* `openssl s_client -connect <IP>:<PORT>`
  * `R` to test renegociation
* `nc <IP> <PORT>`
  * `curl <IP> -s -L | html2text -width '99'`
  * `curl <IP> -s -L | grep "title\|href"`

#### HTTPS certificate

* Check certificate information
  * Issuer
  * Certificate Subject Alt Name (looking for subdomains)

Check if there is some (sub)domain o the email address

#### HTTP methods

* `OPTIONS /path HTTP/1.0`
  * If `PUT` is possible without authentication : `curl --upload-file <FILE>.txt -v --url http://<IP>/<PATH>/<FILE> -0 --http1.0`

### Directory listing

* `gobuster -u <IP> -w /usr/share/seclists/Discovery/Web-Content/common.txt -s '200,204,301,302,307,403,500' -e`
  * Add `-k` due to https protocol
* `dirb <IP> /usr/share/seclists/Discovery/Web-Content/big.txt`
* Wordlists :
  * dirb : `/usr/share/wordlists/dirb`
  * wfuzz : `/usr/share/wfuzz/wordlist`
  * seclist : `/usr/share/seclists`
* Start with a little one as `common`, then a biggest then a wordlist dedicated to a technology (IIS, Apache, nginx ...)
* Start enumerate on **subfolders** AND **files**
  * Ex: Start on
    * Then on `<ip>/sub-folder`
    * Then on `<ip>/index.php`
* When you find a file start enumerate the extension
  * Wordlists :
    * /opt/wordlists/ContentDiscovery/common-extensions.txt
    * /usr/share/wfuzz/wordlist/general/extensions\_common.txt
    * /usr/share/dirb/wordlists/extensions\_common.txt
      * Ex: `.php~` -> backup for PHP file, could leak the source code
* Acces to a Git repo
  * Check every commit looking for password
    * `git log`
    * `git reflog`

### Nmap NSE

* Apache : `sudo nmap -p<PORT> --script "*apache*" -vvv -oA <FILE> <IP>`
* IIS : `sudo nmap -p<PORT> --script "*iis*" -vvv -oA <FILE> <IP>`
* Webdav : `sudo nmap -p<PORT> --script "*webdav*" -vvv -oA <FILE> <IP>`
* Shellshock : `sudo nmap -p80 --script "*shellshock*" --script-args uri=/cgi-bin/test.cgi --script-args uri=/cgi-bin/admin.cgi -vvv -oA <FILE> <IP>`
  * To start if you find a `/cgi-bin` directory
* BigData :
  * http-enum
  * hbase-master-info.nse
  * hbase-region-info.nse
  * flume-master-info.nse

### Wordpress

* Enumérer les plugins : `wpscan --url http://<IP>/<PATH>/ --enumerate p`
  * Tous les plugins : `ap`
* Enumérer les themes : `wpscan --url http://<IP>/<PATH>/ --enumerate t`
  * Tous les themes : `at`
* Enumérer les utilisateurs : `wpscan --url http://<IP>/<PATH>/ --enumerate u`
* Désactiver le check SSL : `--disable-tls-checks`
* Dossiers/fichiers WP interessant :
  * http:///wp/
  * http:///wp-admin/
  * http:///wp-content/ : Plugins for wordpress directory
    * Check the version of each plugin and the associated vulnerabilities
  * http:///wp-login.php
  * http:///wp-config.php : Credentials for DB
* Utiliser `searchsploit` en plus de `wp-scan` pour trouver des vulnérabilité sur les plugins

### IIS

* [https://poc-server.com/blog/2018/05/22/rce-by-uploading-a-web-config/](https://poc-server.com/blog/2018/05/22/rce-by-uploading-a-web-config/)
* [https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)
* [https://soroush.secproject.com/blog/2014/07/file-upload-and-php-on-iis-wildcards/](https://soroush.secproject.com/blog/2014/07/file-upload-and-php-on-iis-wildcards/)

ASP, ASPX, ASP-EXE

#### IIS shortname vulnerability

* [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)
* [https://github.com/lijiejie/IIS\_shortname\_Scanner](https://github.com/lijiejie/IIS\_shortname\_Scanner)
* [https://en.wikipedia.org/wiki/8.3\_filename](https://en.wikipedia.org/wiki/8.3\_filename)
* [https://0xdf.gitlab.io/2020/06/08/endgame-poo.html#recon](https://0xdf.gitlab.io/2020/06/08/endgame-poo.html#recon)

### Drupal

* `droopescan`
* To get the version : `<IP>\CHANGELOG.txt`
* Enable PHP code in Modules - PHP filter (from admin panel)
  * Create an Article
    * RCE

### SSL configuration

* sslscan: `sslscan <IP>`
* testssl
* sslyze : [https://github.com/nabla-c0d3/sslyze](https://github.com/nabla-c0d3/sslyze)
  * `sslyze --heartbleed <IP>`

### Web Server Gateway Interface

* WSGI
  * Example : Werkzeug

```
>>> import socket
>>> print(socket.gethostname())
```

```
>>> import os
>>> print(os.environ)
```

```
>>> f = os.popen("<command-system>")
>>> r = f.read()
>>> print("", r)
```

### CGI

* mod\_cgi : handles all the CGI requests
  * La présence /cgi-bin/<> permet de savoir que Apache's mod\_cgi is enabled
* CGI-based web server : When a web server uses the Common Gateway Interface (CGI) to handle a document request, it copies certain information from the request into the environment variable list and then delegates the request to a handler program. If the handler is a Bash script, or if it executes one for example using the system(3) call, Bash will receive the environment variables passed by the server and will process them as described above. This provides a means for an attacker to trigger the Shellshock vulnerability with a specially crafted document request. OpenSSH server ; DHCP clients ; Qmail clients ; IBM HMC restricted shell

> WiP shellshock

Web CGI programs can be written in any language which can process standard input (stdin), environment variables and write to standard output (stdout) Ex : [http://www.yolinux.com/TUTORIALS/BashShellCgi.html](http://www.yolinux.com/TUTORIALS/BashShellCgi.html)

On peut déposer un script shell/php/perl/python/... dans CGI bin pour le faire exécuter par l'application web. Si l'app web tourne en root le script sera lancé dans un context root (lancer un shell, créer un utilisateur ...) Doit commencer par echo/print/... "Content-type: text/html"

Code :

```
#!/bin/bash
echo "Content-type: text/html"		# Mandatory
echo ""								# Mandatory
echo "<html><head><title>Bash as CGI"
echo "</title></head><body>"

echo "<h1>Hello world</h1>"
echo "Today is $(<COMMAND>)"

echo "</body></html>"
```

Ajouter droits d'exécution : chmod +x first.cgi

* Red Hat Enterprise, 7.x-9, Fedora core, CentOS `/var/www/cgi-bin/`
* Red Hat 6.x and older `/home/httpd/cgi-bin/`
* SuSe `/srv/www/cgi-bin/`
* Ubuntu/Debian `/usr/lib/cgi-bin/`

## WebDAV

* WebDav est une extension du protocole HTTP
  * Simplifie la gestion des fichiers
    * Permet de récupérer/déposer/synchroniser/publier fichiers/dossiers rapidement/facilement
    * Permet à plusieurs utilisateurs d'éditer simultanément le contenus d'un fichier. Gestion des accés/droits
  * Ajoute les méthodes suivantes : COPY, LOCK, MKCOL, MOVE, PROPFIND, PROPPATCH, UNLOCK
* L'outil va tenter de download et d'executer divers fichiers de diverses extensions : `davtest -url <URL>`
* Upload un fichier en ajoutant l'extension .txt pour bypass les restrictions : `davtest -url <URL> -uploadfile <REVERSE-SEHLL>.asp -uploadloc <REVERSE-SHELL>.asp.txt -debug 3`
* `cadaver http://10.11.1.229/`
  * `dav:/> move rs-asp.asp.txt /rs/rs-asp.asp;.txt`
    * Le `;` permet d'indiquer la fin de ligne
    * Il se peut qu'un message d'erreur s'affiche mais que le `move` ai quand même fonctionné
* On se met en écoute et on se rends sur l'URL contenant le reverse shell

## App JAVA

Remplacer .faces par xhtml
